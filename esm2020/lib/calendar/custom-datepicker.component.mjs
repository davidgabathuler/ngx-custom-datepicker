import { Component, Input, ViewChildren, EventEmitter, Output, ViewEncapsulation, ContentChildren } from '@angular/core';
import { CalendarService } from '../_service/calendar.service';
import { DayDirective } from '../day.directive';
import * as i0 from "@angular/core";
import * as i1 from "../_service/calendar.service";
import * as i2 from "../month-view/month-view.component";
import * as i3 from "../month-select/month-select.component";
import * as i4 from "@angular/common";
export class CustomDatepickerComponent {
    constructor(calendarService, cdr) {
        this.calendarService = calendarService;
        this.cdr = cdr;
        /**
         * @description
         *  Array of selected dates.
         * */
        this.selectedDates = [];
        this.selectedDatesChange = new EventEmitter();
        /**
         * @description
         *  Callback event when click on day
         */
        this.onDayClick = new EventEmitter();
        /**
         * @description
         * Start week day, default 0
         */
        this.weekStart = 0;
        /**
         * @description
         * Weekends, default [0,6], set Day.isWeekend true
         */
        this.weekends = [0, 6];
        this.dayDirectives = [];
    }
    __getDirectives() {
        if (this.dayDirectivesQueryList) {
            this.dayDirectives = this.dayDirectivesQueryList.toArray();
            this.dayDirectivesQueryList.changes.subscribe((data) => {
                this.dayDirectives = data.toArray();
            });
        }
    }
    ngAfterViewInit() {
        this.__getDirectives();
    }
    getMonthDayDirectives(date) {
        return this.dayDirectives.filter((directive) => directive.date.getMonth() === date.getMonth() && directive.date.getFullYear() === date.getFullYear());
    }
    recountWidth() {
        let width = 0;
        this.columns ? this.columns.toArray().map((item) => (width += item.elementView.nativeElement.clientWidth)) : null;
        this.calendarService.animationStep.value === 'stop' && this.calendarService.viewSelectorMode === 'days'
            ? (this.width = width)
            : null;
        this.cdr.detectChanges();
    }
    ngAfterViewChecked() {
        this.recountWidth();
    }
    ngOnInit() {
        if (!this.shownDate) {
            this.shownDate = new Date();
        }
        this.calendarService.animationStep.subscribe((data) => {
            if (data === 'stop') {
                setTimeout(() => this.recountWidth(), 10);
            }
        });
        this.calendarService.selectedDates.subscribe((data) => {
            this.selectedDatesChange.emit(data);
        });
        this.calendarService.clickDayKey.subscribe((data) => {
            data ? this.onDayClick.emit(data.day) : null;
        });
        this.calendarService.days.next(this.days);
        this.calendarService.weekStart = this.weekStart;
        this.calendarService.weekends = this.weekends;
        this.calendarService.viewMode = this.viewMode;
        this.calendarService.viewSelectorMode = 'days';
        this.calendarService.selectMode = this.selectMode;
        this.calendarService.shownDate = this.shownDate;
        this.calendarService.setSelectedDates(this.selectedDates);
        this.calendarService.setDays(this.days);
        this.calendarService.getShownMonths(this.shownDate);
        this.calendarService.setDisabledDates(this.disabledDates);
    }
    getCalendar() {
        return this.calendarService.calendar;
    }
    getViewSelectorMode() {
        return this.calendarService.viewSelectorMode;
    }
    calculate() {
        const date = this.shownDate;
        let countMonths = 0;
        const months = [];
        const lastDate = date ? date : this.calendarService.getLastDate();
        countMonths = this.calendarService.getCountMonths();
        for (let i = countMonths - 1; i >= 0; i--) {
            months.push(new Date(lastDate).adjustMonth(-i));
        }
        return months;
    }
    isEqual(array, array1) {
        console.log(array, array1);
        const a = array.filter((item) => array1.includes(item));
        return a.length === 0 && array.length === array1.length;
    }
    _viewMode(simpleChange) {
        if (simpleChange.viewMode.currentValue !== simpleChange.viewMode.previousValue) {
            this.calendarService.viewMode = simpleChange.viewMode.currentValue;
            this.calendarService.getShownMonths(this.shownDate);
            setTimeout(() => this.recountWidth(), 10);
        }
    }
    _selectMode(simpleChange) {
        if (simpleChange.selectMode.currentValue !== simpleChange.selectMode.previousValue) {
            this.calendarService.selectMode = simpleChange.selectMode.currentValue;
            this.calendarService.getShownMonths(this.shownDate);
            setTimeout(() => this.recountWidth(), 10);
        }
    }
    _shownDate(simpleChange) {
        if (simpleChange.shownDate.currentValue !== simpleChange.shownDate.previousValue) {
            this.calendarService.shownDate = simpleChange.shownDate.currentValue;
            this.calendarService.getShownMonths(this.shownDate);
            setTimeout(() => this.recountWidth(), 10);
        }
    }
    ngOnChanges(simpleChange) {
        simpleChange.viewMode && this._viewMode(simpleChange);
        simpleChange.selectMode && this._selectMode(simpleChange);
        simpleChange.shownDate && this._shownDate(simpleChange);
        simpleChange.days && this.calendarService.days.next(this.days);
        simpleChange.selectedDates && this.calendarService.setSelectedDates(this.selectedDates);
    }
    goNext() {
        const lastDate = this.calendarService.calendar[this.calendarService.calendar.length - 1];
        this.calendarService.goNext(lastDate);
    }
    goPrev() {
        const firstDate = this.calendarService.calendar[0];
        this.calendarService.goPrev(firstDate);
    }
}
/** @nocollapse */ CustomDatepickerComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.0", ngImport: i0, type: CustomDatepickerComponent, deps: [{ token: i1.CalendarService }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component });
/** @nocollapse */ CustomDatepickerComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.3.0", type: CustomDatepickerComponent, selector: "ngx-custom-datepicker", inputs: { selectedDates: "selectedDates", days: "days", shownDate: "shownDate", viewMode: "viewMode", weekStart: "weekStart", weekends: "weekends", selectMode: "selectMode", disabledDates: "disabledDates" }, outputs: { selectedDatesChange: "selectedDatesChange", onDayClick: "onDayClick" }, providers: [CalendarService], queries: [{ propertyName: "dayDirectivesQueryList", predicate: DayDirective }], viewQueries: [{ propertyName: "columns", predicate: ["column"], descendants: true }], usesOnChanges: true, ngImport: i0, template: "<div class=\"calendarWrap\">\n  <div class=\"headerCalendar\"></div>\n  <div class=\"dateSelector\">\n    <div (click)=\"goPrev()\" class=\"nextPrevBtn\" style=\"left: 0\">{{ '<' }}</div>\n    <div class=\"wrapMonths\" [ngStyle]=\"{ width: width + 'px' }\">\n      <div class=\"months\" *ngIf=\"getViewSelectorMode() === 'days'\">\n        <app-month-view\n          *ngFor=\"let date of getCalendar()\"\n          #column\n          [date]=\"date\"\n          [dayDirectives]=\"getMonthDayDirectives(date)\"\n        >\n        </app-month-view>\n      </div>\n\n      <div *ngIf=\"getViewSelectorMode() === 'months'\" style=\"width: 100%; display: flex; flex: 1\">\n        <app-month-select *ngFor=\"let date of getCalendar()\" #column [date]=\"date\"> </app-month-select>\n      </div>\n    </div>\n    <div (click)=\"goNext()\" class=\"nextPrevBtn\" style=\"right: 0\">{{ '>' }}</div>\n  </div>\n</div>\n", styles: ["app-calendar{display:block;float:left;width:100%}.nextPrevBtn{display:flex;flex-direction:column;justify-content:center;align-items:center;-webkit-user-select:none;-moz-user-select:none;user-select:none;position:absolute;cursor:pointer;padding:8px 16px;transition:all .2s;font-size:.9em;color:#26b1b1;z-index:1;background:#fff}.nextPrevBtn:hover{background:#eee}app-week-view{width:100%;display:flex;flex-direction:row}.dayWeekTitle{flex:1;color:#a9a9a9;justify-content:center;align-items:center;display:flex;font-size:.8em;padding:4px}.styledDay.isWeekEnd{color:#c53c3c}.weekWrap{display:flex;flex-direction:column}app-month-select{display:flex;float:left;min-width:200px;-webkit-animation:appear .2s ease-in-out;animation:appear .2s ease-in-out}.monthItem{width:33%;font-size:.8em;text-align:center;padding:9px 0;box-shadow:0 0 0 1px #f4f3f3;color:#313131}.monthItem:hover{-webkit-user-select:none;-moz-user-select:none;user-select:none;cursor:pointer;background:#eee;transition:.2s}app-month-view{display:flex;float:left;min-width:200px;-webkit-animation:appear .2s ease-in-out;animation:appear .2s ease-in-out;height:100%}@-webkit-keyframes appear{0%{transform:scale(.6);opacity:.6}50%{transform:opacity(0);transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes appear{0%{transform:scale(.6);opacity:.6}50%{transform:opacity(0);transform:scale(.8)}to{opacity:1;transform:scale(1)}}.months{display:flex;flex-direction:row;position:relative;overflow:hidden;height:100%}.wrapMonths{display:block;float:left;overflow:hidden;width:477px}.monthOne{position:relative}.monthOne.right{-webkit-animation:right .2s ease-in-out;animation:right .2s ease-in-out}.monthOne.left{-webkit-animation:left .2s ease-in-out;animation:left .2s ease-in-out}@-webkit-keyframes left{0%{transform:translate(-100%)}to{transform:translate(0)}}@keyframes left{0%{transform:translate(-100%)}to{transform:translate(0)}}@-webkit-keyframes right{0%{transform:translate(0)}to{transform:translate(-100%)}}@keyframes right{0%{transform:translate(0)}to{transform:translate(-100%)}}.monthSelectBtn{display:flex;flex-direction:row;flex:1;padding:4px 8px}app-day-view{display:block;float:left;width:100%}.styledDay.isDisabled{color:#a7a7a7}.styledDay.isInPeriod{background:#26b1b12b!important}.styledDay.isSelected{background:#26b1b180!important}.styledDay.isSelected.period.end{background:linear-gradient(120deg,#26b1b12b 45%,#26b1b180 113%)!important;-webkit-animation:appear .2s ease-in-out;animation:appear .2s ease-in-out}.styledDay.isSelected.period.start{background:linear-gradient(-50deg,#26b1b12b 45%,#26b1b180 113%)!important;-webkit-animation:appear .2s ease-in-out;animation:appear .2s ease-in-out}.day{display:flex;flex:1;font-size:.8em;padding:6px}.dayDir{display:block;float:left;width:100%;height:100%}.styledDay{display:flex;flex:1;flex-direction:column;justify-content:center;align-items:center;color:#313131;transition:all .2s}.styledDay:hover{background:#eee;cursor:pointer;color:#313131;-webkit-user-select:none;-moz-user-select:none;user-select:none}.dayWrap{display:flex;flex:1;height:100%;width:100%}.calendarWrap{float:left;display:flex;background:#fff;flex-direction:column;border-radius:4px;transition:all .2s;width:-webkit-min-content;width:-moz-min-content;width:min-content}.dateSelector{float:left;width:auto;display:flex;position:relative;flex-direction:row;transition:all .2s}.monthWrap{padding:0 8px;display:block;float:left;width:100%}.f1{display:flex;flex:1}.monthHeader{text-align:center;padding:8px 16px;font-size:15px;color:#2b2b2b}.monthHeader:first-letter{text-transform:uppercase}.monthHeader:hover{cursor:pointer;-webkit-user-select:none;-moz-user-select:none;user-select:none;background:#eee}\n"], components: [{ type: i2.MonthViewComponent, selector: "app-month-view", inputs: ["date", "updateDate", "dayDirectives"], outputs: ["elWidth"] }, { type: i3.MonthSelectComponent, selector: "app-month-select", inputs: ["date"] }], directives: [{ type: i4.NgStyle, selector: "[ngStyle]", inputs: ["ngStyle"] }, { type: i4.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i4.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }], encapsulation: i0.ViewEncapsulation.None });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.0", ngImport: i0, type: CustomDatepickerComponent, decorators: [{
            type: Component,
            args: [{ selector: 'ngx-custom-datepicker', providers: [CalendarService], encapsulation: ViewEncapsulation.None, template: "<div class=\"calendarWrap\">\n  <div class=\"headerCalendar\"></div>\n  <div class=\"dateSelector\">\n    <div (click)=\"goPrev()\" class=\"nextPrevBtn\" style=\"left: 0\">{{ '<' }}</div>\n    <div class=\"wrapMonths\" [ngStyle]=\"{ width: width + 'px' }\">\n      <div class=\"months\" *ngIf=\"getViewSelectorMode() === 'days'\">\n        <app-month-view\n          *ngFor=\"let date of getCalendar()\"\n          #column\n          [date]=\"date\"\n          [dayDirectives]=\"getMonthDayDirectives(date)\"\n        >\n        </app-month-view>\n      </div>\n\n      <div *ngIf=\"getViewSelectorMode() === 'months'\" style=\"width: 100%; display: flex; flex: 1\">\n        <app-month-select *ngFor=\"let date of getCalendar()\" #column [date]=\"date\"> </app-month-select>\n      </div>\n    </div>\n    <div (click)=\"goNext()\" class=\"nextPrevBtn\" style=\"right: 0\">{{ '>' }}</div>\n  </div>\n</div>\n", styles: ["app-calendar{display:block;float:left;width:100%}.nextPrevBtn{display:flex;flex-direction:column;justify-content:center;align-items:center;-webkit-user-select:none;-moz-user-select:none;user-select:none;position:absolute;cursor:pointer;padding:8px 16px;transition:all .2s;font-size:.9em;color:#26b1b1;z-index:1;background:#fff}.nextPrevBtn:hover{background:#eee}app-week-view{width:100%;display:flex;flex-direction:row}.dayWeekTitle{flex:1;color:#a9a9a9;justify-content:center;align-items:center;display:flex;font-size:.8em;padding:4px}.styledDay.isWeekEnd{color:#c53c3c}.weekWrap{display:flex;flex-direction:column}app-month-select{display:flex;float:left;min-width:200px;-webkit-animation:appear .2s ease-in-out;animation:appear .2s ease-in-out}.monthItem{width:33%;font-size:.8em;text-align:center;padding:9px 0;box-shadow:0 0 0 1px #f4f3f3;color:#313131}.monthItem:hover{-webkit-user-select:none;-moz-user-select:none;user-select:none;cursor:pointer;background:#eee;transition:.2s}app-month-view{display:flex;float:left;min-width:200px;-webkit-animation:appear .2s ease-in-out;animation:appear .2s ease-in-out;height:100%}@-webkit-keyframes appear{0%{transform:scale(.6);opacity:.6}50%{transform:opacity(0);transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes appear{0%{transform:scale(.6);opacity:.6}50%{transform:opacity(0);transform:scale(.8)}to{opacity:1;transform:scale(1)}}.months{display:flex;flex-direction:row;position:relative;overflow:hidden;height:100%}.wrapMonths{display:block;float:left;overflow:hidden;width:477px}.monthOne{position:relative}.monthOne.right{-webkit-animation:right .2s ease-in-out;animation:right .2s ease-in-out}.monthOne.left{-webkit-animation:left .2s ease-in-out;animation:left .2s ease-in-out}@-webkit-keyframes left{0%{transform:translate(-100%)}to{transform:translate(0)}}@keyframes left{0%{transform:translate(-100%)}to{transform:translate(0)}}@-webkit-keyframes right{0%{transform:translate(0)}to{transform:translate(-100%)}}@keyframes right{0%{transform:translate(0)}to{transform:translate(-100%)}}.monthSelectBtn{display:flex;flex-direction:row;flex:1;padding:4px 8px}app-day-view{display:block;float:left;width:100%}.styledDay.isDisabled{color:#a7a7a7}.styledDay.isInPeriod{background:#26b1b12b!important}.styledDay.isSelected{background:#26b1b180!important}.styledDay.isSelected.period.end{background:linear-gradient(120deg,#26b1b12b 45%,#26b1b180 113%)!important;-webkit-animation:appear .2s ease-in-out;animation:appear .2s ease-in-out}.styledDay.isSelected.period.start{background:linear-gradient(-50deg,#26b1b12b 45%,#26b1b180 113%)!important;-webkit-animation:appear .2s ease-in-out;animation:appear .2s ease-in-out}.day{display:flex;flex:1;font-size:.8em;padding:6px}.dayDir{display:block;float:left;width:100%;height:100%}.styledDay{display:flex;flex:1;flex-direction:column;justify-content:center;align-items:center;color:#313131;transition:all .2s}.styledDay:hover{background:#eee;cursor:pointer;color:#313131;-webkit-user-select:none;-moz-user-select:none;user-select:none}.dayWrap{display:flex;flex:1;height:100%;width:100%}.calendarWrap{float:left;display:flex;background:#fff;flex-direction:column;border-radius:4px;transition:all .2s;width:-webkit-min-content;width:-moz-min-content;width:min-content}.dateSelector{float:left;width:auto;display:flex;position:relative;flex-direction:row;transition:all .2s}.monthWrap{padding:0 8px;display:block;float:left;width:100%}.f1{display:flex;flex:1}.monthHeader{text-align:center;padding:8px 16px;font-size:15px;color:#2b2b2b}.monthHeader:first-letter{text-transform:uppercase}.monthHeader:hover{cursor:pointer;-webkit-user-select:none;-moz-user-select:none;user-select:none;background:#eee}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.CalendarService }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { selectedDates: [{
                type: Input
            }], selectedDatesChange: [{
                type: Output
            }], onDayClick: [{
                type: Output
            }], days: [{
                type: Input
            }], shownDate: [{
                type: Input
            }], viewMode: [{
                type: Input
            }], weekStart: [{
                type: Input
            }], weekends: [{
                type: Input
            }], selectMode: [{
                type: Input
            }], disabledDates: [{
                type: Input
            }], columns: [{
                type: ViewChildren,
                args: ['column']
            }], dayDirectivesQueryList: [{
                type: ContentChildren,
                args: [DayDirective]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3VzdG9tLWRhdGVwaWNrZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LWN1c3RvbS1kYXRlcGlja2VyL3NyYy9saWIvY2FsZW5kYXIvY3VzdG9tLWRhdGVwaWNrZXIuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LWN1c3RvbS1kYXRlcGlja2VyL3NyYy9saWIvY2FsZW5kYXIvY3VzdG9tLWRhdGVwaWNrZXIuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLFNBQVMsRUFFVCxLQUFLLEVBRUwsWUFBWSxFQUVaLFlBQVksRUFDWixNQUFNLEVBRU4saUJBQWlCLEVBRWpCLGVBQWUsRUFHaEIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBRS9ELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQzs7Ozs7O0FBU2hELE1BQU0sT0FBTyx5QkFBeUI7SUFtRXBDLFlBQW9CLGVBQWdDLEVBQVUsR0FBc0I7UUFBaEUsb0JBQWUsR0FBZixlQUFlLENBQWlCO1FBQVUsUUFBRyxHQUFILEdBQUcsQ0FBbUI7UUFsRXBGOzs7YUFHSztRQUNJLGtCQUFhLEdBQVcsRUFBRSxDQUFDO1FBQzFCLHdCQUFtQixHQUFHLElBQUksWUFBWSxFQUFVLENBQUM7UUFFM0Q7OztXQUdHO1FBQ08sZUFBVSxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFxQi9DOzs7V0FHRztRQUNNLGNBQVMsR0FBRyxDQUFDLENBQUM7UUFFdkI7OztXQUdHO1FBQ00sYUFBUSxHQUFhLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBc0JyQyxrQkFBYSxHQUFtQixFQUFFLENBQUM7SUFFb0QsQ0FBQztJQUVoRixlQUFlO1FBQ3JCLElBQUksSUFBSSxDQUFDLHNCQUFz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ZUFBZSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDekYsSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDeEMsQ0FBQztJQUNELE1BQU07UUFDSixNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNuRCxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUN6QyxDQUFDOzt5SUF6TVUseUJBQXlCOzZIQUF6Qix5QkFBeUIsbVZBSHpCLENBQUMsZUFBZSxDQUFDLGlFQWtFWCxZQUFZLHdJQzFGL0IsKzRCQXNCQTsyRkRLYSx5QkFBeUI7a0JBUHJDLFNBQVM7K0JBQ0UsdUJBQXVCLGFBR3RCLENBQUMsZUFBZSxDQUFDLGlCQUNiLGlCQUFpQixDQUFDLElBQUk7c0lBTzVCLGFBQWE7c0JBQXJCLEtBQUs7Z0JBQ0ksbUJBQW1CO3NCQUE1QixNQUFNO2dCQU1HLFVBQVU7c0JBQW5CLE1BQU07Z0JBT0UsSUFBSTtzQkFBWixLQUFLO2dCQU1HLFNBQVM7c0JBQWpCLEtBQUs7Z0JBTUcsUUFBUTtzQkFBaEIsS0FBSztnQkFNRyxTQUFTO3NCQUFqQixLQUFLO2dCQU1HLFFBQVE7c0JBQWhCLEtBQUs7Z0JBT0csVUFBVTtzQkFBbEIsS0FBSztnQkFPRyxhQUFhO3NCQUFyQixLQUFLO2dCQUVrQixPQUFPO3NCQUE5QixZQUFZO3VCQUFDLFFBQVE7Z0JBS3RCLHNCQUFzQjtzQkFEckIsZUFBZTt1QkFBQyxZQUFZIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBPbkluaXQsXG4gIElucHV0LFxuICBPbkNoYW5nZXMsXG4gIFZpZXdDaGlsZHJlbixcbiAgQWZ0ZXJWaWV3Q2hlY2tlZCxcbiAgRXZlbnRFbWl0dGVyLFxuICBPdXRwdXQsXG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBWaWV3RW5jYXBzdWxhdGlvbixcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ29udGVudENoaWxkcmVuLFxuICBBZnRlckNvbnRlbnRJbml0LFxuICBRdWVyeUxpc3Rcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDYWxlbmRhclNlcnZpY2UgfSBmcm9tICcuLi9fc2VydmljZS9jYWxlbmRhci5zZXJ2aWNlJztcbmltcG9ydCB7IERheSwgU2VsZWN0TW9kZSwgVmlld01vZGUsIERpc2FibGVkRGF0ZXMgfSBmcm9tICcuLi9pbnRlcmZhY2VzJztcbmltcG9ydCB7IERheURpcmVjdGl2ZSB9IGZyb20gJy4uL2RheS5kaXJlY3RpdmUnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICduZ3gtY3VzdG9tLWRhdGVwaWNrZXInLFxuICB0ZW1wbGF0ZVVybDogJy4vY3VzdG9tLWRhdGVwaWNrZXIuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9jdXN0b20tZGF0ZXBpY2tlci5jb21wb25lbnQuc2NzcyddLFxuICBwcm92aWRlcnM6IFtDYWxlbmRhclNlcnZpY2VdLFxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lXG59KVxuZXhwb3J0IGNsYXNzIEN1c3RvbURhdGVwaWNrZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgQWZ0ZXJWaWV3Q2hlY2tlZCwgQWZ0ZXJWaWV3SW5pdCB7XG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogIEFycmF5IG9mIHNlbGVjdGVkIGRhdGVzLlxuICAgKiAqL1xuICBASW5wdXQoKSBzZWxlY3RlZERhdGVzOiBEYXRlW10gPSBbXTtcbiAgQE91dHB1dCgpIHNlbGVjdGVkRGF0ZXNDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPERhdGVbXT4oKTtcblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqICBDYWxsYmFjayBldmVudCB3aGVuIGNsaWNrIG9uIGRheVxuICAgKi9cbiAgQE91dHB1dCgpIG9uRGF5Q2xpY2sgPSBuZXcgRXZlbnRFbWl0dGVyPERheT4oKTtcblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqICBBcnJheSBjdXN0b20gZGVmaW5pdGlvbnMgb2YgZGF5cy4gU3Vic2NyaWJhYmxlXG4gICAqIEBzZWUgYERheWBcbiAgICogKi9cbiAgQElucHV0KCkgZGF5czogRGF5W107XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiAgRGF0ZSB3aG91bGQgYmUgcmVuZGVyIGZvciBkZWZhdWx0IGNhbGVuZGFyIC5cbiAgICogKi9cbiAgQElucHV0KCkgc2hvd25EYXRlOiBEYXRlO1xuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogUHJlc2VudCBtb2RlIG9mIGNhbGVuZGFyLiBZZWFyLCBxdWFydGVyLCBzZW1lc3RlciBvciBxdHkgbW9udGhzLiBEZWZhdWx0IDEuXG4gICAqICovXG4gIEBJbnB1dCgpIHZpZXdNb2RlOiBWaWV3TW9kZSB8IG51bWJlcjtcblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIFN0YXJ0IHdlZWsgZGF5LCBkZWZhdWx0IDBcbiAgICovXG4gIEBJbnB1dCgpIHdlZWtTdGFydCA9IDA7XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBXZWVrZW5kcywgZGVmYXVsdCBbMCw2XSwgc2V0IERheS5pc1dlZWtlbmQgdHJ1ZVxuICAgKi9cbiAgQElucHV0KCkgd2Vla2VuZHM6IG51bWJlcltdID0gWzAsIDZdO1xuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogU2luZ2xlLCBNdWx0aXBsZSwgUGVyaW9kXG4gICAqIEBTZWUgYFNlbGVjdE1vZGVgXG4gICAqL1xuICBASW5wdXQoKSBzZWxlY3RNb2RlOiBTZWxlY3RNb2RlO1xuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogRGlzYWJsZSBzZWxlY3QgZGF0ZXMuIEJlZm9yZSBhZnRlciBkYXRlIG9yIGFycmF5XG4gICAqIEBTZWUgYERpc2FibGVkRGF0ZXNgXG4gICAqL1xuICBASW5wdXQoKSBkaXNhYmxlZERhdGVzOiBEaXNhYmxlZERhdGVzO1xuXG4gIEBWaWV3Q2hpbGRyZW4oJ2NvbHVtbicpIGNvbHVtbnM7XG5cbiAgd2lkdGg6IG51bWJlciB8IG51bGw7XG5cbiAgQENvbnRlbnRDaGlsZHJlbihEYXlEaXJlY3RpdmUpXG4gIGRheURpcmVjdGl2ZXNRdWVyeUxpc3Q6IFF1ZXJ5TGlzdDxEYXlEaXJlY3RpdmU+O1xuICBkYXlEaXJlY3RpdmVzOiBEYXlEaXJlY3RpdmVbXSA9IFtdO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgY2FsZW5kYXJTZXJ2aWNlOiBDYWxlbmRhclNlcnZpY2UsIHByaXZhdGUgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZikge31cblxuICBwcml2YXRlIF9fZ2V0RGlyZWN0aXZlcygpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5kYXlEaXJlY3RpdmVzUXVlcnlMaXN0KSB7XG4gICAgICB0aGlzLmRheURpcmVjdGl2ZXMgPSB0aGlzLmRheURpcmVjdGl2ZXNRdWVyeUxpc3QudG9BcnJheSgpO1xuICAgICAgdGhpcy5kYXlEaXJlY3RpdmVzUXVlcnlMaXN0LmNoYW5nZXMuc3Vic2NyaWJlKChkYXRhKSA9PiB7XG4gICAgICAgIHRoaXMuZGF5RGlyZWN0aXZlcyA9IGRhdGEudG9BcnJheSgpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuICAgIHRoaXMuX19nZXREaXJlY3RpdmVzKCk7XG4gIH1cblxuICBnZXRNb250aERheURpcmVjdGl2ZXMoZGF0ZTogRGF0ZSk6IERheURpcmVjdGl2ZVtdIHtcbiAgICByZXR1cm4gdGhpcy5kYXlEaXJlY3RpdmVzLmZpbHRlcihcbiAgICAgIChkaXJlY3RpdmU6IERheURpcmVjdGl2ZSkgPT5cbiAgICAgICAgZGlyZWN0aXZlLmRhdGUuZ2V0TW9udGgoKSA9PT0gZGF0ZS5nZXRNb250aCgpICYmIGRpcmVjdGl2ZS5kYXRlLmdldEZ1bGxZZWFyKCkgPT09IGRhdGUuZ2V0RnVsbFllYXIoKVxuICAgICk7XG4gIH1cblxuICByZWNvdW50V2lkdGgoKTogdm9pZCB7XG4gICAgbGV0IHdpZHRoID0gMDtcbiAgICB0aGlzLmNvbHVtbnMgPyB0aGlzLmNvbHVtbnMudG9BcnJheSgpLm1hcCgoaXRlbSkgPT4gKHdpZHRoICs9IGl0ZW0uZWxlbWVudFZpZXcubmF0aXZlRWxlbWVudC5jbGllbnRXaWR0aCkpIDogbnVsbDtcbiAgICB0aGlzLmNhbGVuZGFyU2VydmljZS5hbmltYXRpb25TdGVwLnZhbHVlID09PSAnc3RvcCcgJiYgdGhpcy5jYWxlbmRhclNlcnZpY2Uudmlld1NlbGVjdG9yTW9kZSA9PT0gJ2RheXMnXG4gICAgICA/ICh0aGlzLndpZHRoID0gd2lkdGgpXG4gICAgICA6IG51bGw7XG5cbiAgICB0aGlzLmNkci5kZXRlY3RDaGFuZ2VzKCk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0NoZWNrZWQoKTogdm9pZCB7XG4gICAgdGhpcy5yZWNvdW50V2lkdGgoKTtcbiAgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5zaG93bkRhdGUpIHtcbiAgICAgIHRoaXMuc2hvd25EYXRlID0gbmV3IERhdGUoKTtcbiAgICB9XG5cbiAgICB0aGlzLmNhbGVuZGFyU2VydmljZS5hbmltYXRpb25TdGVwLnN1YnNjcmliZSgoZGF0YSkgPT4ge1xuICAgICAgaWYgKGRhdGEgPT09ICdzdG9wJykge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMucmVjb3VudFdpZHRoKCksIDEwKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMuY2FsZW5kYXJTZXJ2aWNlLnNlbGVjdGVkRGF0ZXMuc3Vic2NyaWJlKChkYXRhKSA9PiB7XG4gICAgICB0aGlzLnNlbGVjdGVkRGF0ZXNDaGFuZ2UuZW1pdChkYXRhKTtcbiAgICB9KTtcblxuICAgIHRoaXMuY2FsZW5kYXJTZXJ2aWNlLmNsaWNrRGF5S2V5LnN1YnNjcmliZSgoZGF0YSkgPT4ge1xuICAgICAgZGF0YSA/IHRoaXMub25EYXlDbGljay5lbWl0KGRhdGEuZGF5KSA6IG51bGw7XG4gICAgfSk7XG5cbiAgICB0aGlzLmNhbGVuZGFyU2VydmljZS5kYXlzLm5leHQodGhpcy5kYXlzKTtcbiAgICB0aGlzLmNhbGVuZGFyU2VydmljZS53ZWVrU3RhcnQgPSB0aGlzLndlZWtTdGFydDtcbiAgICB0aGlzLmNhbGVuZGFyU2VydmljZS53ZWVrZW5kcyA9IHRoaXMud2Vla2VuZHM7XG4gICAgdGhpcy5jYWxlbmRhclNlcnZpY2Uudmlld01vZGUgPSB0aGlzLnZpZXdNb2RlO1xuICAgIHRoaXMuY2FsZW5kYXJTZXJ2aWNlLnZpZXdTZWxlY3Rvck1vZGUgPSAnZGF5cyc7XG4gICAgdGhpcy5jYWxlbmRhclNlcnZpY2Uuc2VsZWN0TW9kZSA9IHRoaXMuc2VsZWN0TW9kZTtcbiAgICB0aGlzLmNhbGVuZGFyU2VydmljZS5zaG93bkRhdGUgPSB0aGlzLnNob3duRGF0ZTtcbiAgICB0aGlzLmNhbGVuZGFyU2VydmljZS5zZXRTZWxlY3RlZERhdGVzKHRoaXMuc2VsZWN0ZWREYXRlcyk7XG4gICAgdGhpcy5jYWxlbmRhclNlcnZpY2Uuc2V0RGF5cyh0aGlzLmRheXMpO1xuICAgIHRoaXMuY2FsZW5kYXJTZXJ2aWNlLmdldFNob3duTW9udGhzKHRoaXMuc2hvd25EYXRlKTtcbiAgICB0aGlzLmNhbGVuZGFyU2VydmljZS5zZXREaXNhYmxlZERhdGVzKHRoaXMuZGlzYWJsZWREYXRlcyk7XG4gIH1cblxuICBnZXRDYWxlbmRhcigpIHtcbiAgICByZXR1cm4gdGhpcy5jYWxlbmRhclNlcnZpY2UuY2FsZW5kYXI7XG4gIH1cblxuICBnZXRWaWV3U2VsZWN0b3JNb2RlKCkge1xuICAgIHJldHVybiB0aGlzLmNhbGVuZGFyU2VydmljZS52aWV3U2VsZWN0b3JNb2RlO1xuICB9XG5cbiAgY2FsY3VsYXRlKCkge1xuICAgIGNvbnN0IGRhdGUgPSB0aGlzLnNob3duRGF0ZTtcbiAgICBsZXQgY291bnRNb250aHMgPSAwO1xuICAgIGNvbnN0IG1vbnRocyA9IFtdO1xuICAgIGNvbnN0IGxhc3REYXRlID0gZGF0ZSA/IGRhdGUgOiB0aGlzLmNhbGVuZGFyU2VydmljZS5nZXRMYXN0RGF0ZSgpO1xuICAgIGNvdW50TW9udGhzID0gdGhpcy5jYWxlbmRhclNlcnZpY2UuZ2V0Q291bnRNb250aHMoKTtcblxuICAgIGZvciAobGV0IGkgPSBjb3VudE1vbnRocyAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICBtb250aHMucHVzaChuZXcgRGF0ZShsYXN0RGF0ZSkuYWRqdXN0TW9udGgoLWkpKTtcbiAgICB9XG4gICAgcmV0dXJuIG1vbnRocztcbiAgfVxuXG4gIGlzRXF1YWwoYXJyYXksIGFycmF5MSkge1xuICAgIGNvbnNvbGUubG9nKGFycmF5LCBhcnJheTEpO1xuICAgIGNvbnN0IGEgPSBhcnJheS5maWx0ZXIoKGl0ZW0pID0+IGFycmF5MS5pbmNsdWRlcyhpdGVtKSk7XG4gICAgcmV0dXJuIGEubGVuZ3RoID09PSAwICYmIGFycmF5Lmxlbmd0aCA9PT0gYXJyYXkxLmxlbmd0aDtcbiAgfVxuXG4gIHByaXZhdGUgX3ZpZXdNb2RlKHNpbXBsZUNoYW5nZSkge1xuICAgIGlmIChzaW1wbGVDaGFuZ2Uudmlld01vZGUuY3VycmVudFZhbHVlICE9PSBzaW1wbGVDaGFuZ2Uudmlld01vZGUucHJldmlvdXNWYWx1ZSkge1xuICAgICAgdGhpcy5jYWxlbmRhclNlcnZpY2Uudmlld01vZGUgPSBzaW1wbGVDaGFuZ2Uudmlld01vZGUuY3VycmVudFZhbHVlO1xuICAgICAgdGhpcy5jYWxlbmRhclNlcnZpY2UuZ2V0U2hvd25Nb250aHModGhpcy5zaG93bkRhdGUpO1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLnJlY291bnRXaWR0aCgpLCAxMCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBfc2VsZWN0TW9kZShzaW1wbGVDaGFuZ2UpIHtcbiAgICBpZiAoc2ltcGxlQ2hhbmdlLnNlbGVjdE1vZGUuY3VycmVudFZhbHVlICE9PSBzaW1wbGVDaGFuZ2Uuc2VsZWN0TW9kZS5wcmV2aW91c1ZhbHVlKSB7XG4gICAgICB0aGlzLmNhbGVuZGFyU2VydmljZS5zZWxlY3RNb2RlID0gc2ltcGxlQ2hhbmdlLnNlbGVjdE1vZGUuY3VycmVudFZhbHVlO1xuICAgICAgdGhpcy5jYWxlbmRhclNlcnZpY2UuZ2V0U2hvd25Nb250aHModGhpcy5zaG93bkRhdGUpO1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLnJlY291bnRXaWR0aCgpLCAxMCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBfc2hvd25EYXRlKHNpbXBsZUNoYW5nZSkge1xuICAgIGlmIChzaW1wbGVDaGFuZ2Uuc2hvd25EYXRlLmN1cnJlbnRWYWx1ZSAhPT0gc2ltcGxlQ2hhbmdlLnNob3duRGF0ZS5wcmV2aW91c1ZhbHVlKSB7XG4gICAgICB0aGlzLmNhbGVuZGFyU2VydmljZS5zaG93bkRhdGUgPSBzaW1wbGVDaGFuZ2Uuc2hvd25EYXRlLmN1cnJlbnRWYWx1ZTtcbiAgICAgIHRoaXMuY2FsZW5kYXJTZXJ2aWNlLmdldFNob3duTW9udGhzKHRoaXMuc2hvd25EYXRlKTtcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5yZWNvdW50V2lkdGgoKSwgMTApO1xuICAgIH1cbiAgfVxuXG4gIG5nT25DaGFuZ2VzKHNpbXBsZUNoYW5nZSkge1xuICAgIHNpbXBsZUNoYW5nZS52aWV3TW9kZSAmJiB0aGlzLl92aWV3TW9kZShzaW1wbGVDaGFuZ2UpO1xuICAgIHNpbXBsZUNoYW5nZS5zZWxlY3RNb2RlICYmIHRoaXMuX3NlbGVjdE1vZGUoc2ltcGxlQ2hhbmdlKTtcbiAgICBzaW1wbGVDaGFuZ2Uuc2hvd25EYXRlICYmIHRoaXMuX3Nob3duRGF0ZShzaW1wbGVDaGFuZ2UpO1xuICAgIHNpbXBsZUNoYW5nZS5kYXlzICYmIHRoaXMuY2FsZW5kYXJTZXJ2aWNlLmRheXMubmV4dCh0aGlzLmRheXMpO1xuICAgIHNpbXBsZUNoYW5nZS5zZWxlY3RlZERhdGVzICYmIHRoaXMuY2FsZW5kYXJTZXJ2aWNlLnNldFNlbGVjdGVkRGF0ZXModGhpcy5zZWxlY3RlZERhdGVzKTtcbiAgfVxuXG4gIGdvTmV4dCgpIHtcbiAgICBjb25zdCBsYXN0RGF0ZSA9IHRoaXMuY2FsZW5kYXJTZXJ2aWNlLmNhbGVuZGFyW3RoaXMuY2FsZW5kYXJTZXJ2aWNlLmNhbGVuZGFyLmxlbmd0aCAtIDFdO1xuICAgIHRoaXMuY2FsZW5kYXJTZXJ2aWNlLmdvTmV4dChsYXN0RGF0ZSk7XG4gIH1cbiAgZ29QcmV2KCkge1xuICAgIGNvbnN0IGZpcnN0RGF0ZSA9IHRoaXMuY2FsZW5kYXJTZXJ2aWNlLmNhbGVuZGFyWzBdO1xuICAgIHRoaXMuY2FsZW5kYXJTZXJ2aWNlLmdvUHJldihmaXJzdERhdGUpO1xuICB9XG59XG4iLCI8ZGl2IGNsYXNzPVwiY2FsZW5kYXJXcmFwXCI+XG4gIDxkaXYgY2xhc3M9XCJoZWFkZXJDYWxlbmRhclwiPjwvZGl2PlxuICA8ZGl2IGNsYXNzPVwiZGF0ZVNlbGVjdG9yXCI+XG4gICAgPGRpdiAoY2xpY2spPVwiZ29QcmV2KClcIiBjbGFzcz1cIm5leHRQcmV2QnRuXCIgc3R5bGU9XCJsZWZ0OiAwXCI+e3sgJzwnIH19PC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cIndyYXBNb250aHNcIiBbbmdTdHlsZV09XCJ7IHdpZHRoOiB3aWR0aCArICdweCcgfVwiPlxuICAgICAgPGRpdiBjbGFzcz1cIm1vbnRoc1wiICpuZ0lmPVwiZ2V0Vmlld1NlbGVjdG9yTW9kZSgpID09PSAnZGF5cydcIj5cbiAgICAgICAgPGFwcC1tb250aC12aWV3XG4gICAgICAgICAgKm5nRm9yPVwibGV0IGRhdGUgb2YgZ2V0Q2FsZW5kYXIoKVwiXG4gICAgICAgICAgI2NvbHVtblxuICAgICAgICAgIFtkYXRlXT1cImRhdGVcIlxuICAgICAgICAgIFtkYXlEaXJlY3RpdmVzXT1cImdldE1vbnRoRGF5RGlyZWN0aXZlcyhkYXRlKVwiXG4gICAgICAgID5cbiAgICAgICAgPC9hcHAtbW9udGgtdmlldz5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8ZGl2ICpuZ0lmPVwiZ2V0Vmlld1NlbGVjdG9yTW9kZSgpID09PSAnbW9udGhzJ1wiIHN0eWxlPVwid2lkdGg6IDEwMCU7IGRpc3BsYXk6IGZsZXg7IGZsZXg6IDFcIj5cbiAgICAgICAgPGFwcC1tb250aC1zZWxlY3QgKm5nRm9yPVwibGV0IGRhdGUgb2YgZ2V0Q2FsZW5kYXIoKVwiICNjb2x1bW4gW2RhdGVdPVwiZGF0ZVwiPiA8L2FwcC1tb250aC1zZWxlY3Q+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgICA8ZGl2IChjbGljayk9XCJnb05leHQoKVwiIGNsYXNzPVwibmV4dFByZXZCdG5cIiBzdHlsZT1cInJpZ2h0OiAwXCI+e3sgJz4nIH19PC9kaXY+XG4gIDwvZGl2PlxuPC9kaXY+XG4iXX0=